"use strict";angular.module("bmsApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","mgcrea.ngStrap","gridster","wu.masonry","angularFileUpload"]).run(["$rootScope","User","Auth","$state","PathHistory","$location","StateFilter",function(a,b,c,d,e,f,g){a.appReady=!1,c.request().finally(function(){a.appReady=!0,d.go("main.dashboard")}),a.$on("$stateChangeStart",function(b,c){if(e.add(f.path()),"loading"!=c.name){if(!a.appReady)return b.preventDefault(),void d.go("loading");for(var h=g.get(c),i=h.length-1;i>=0;i--)if(!h[i].passes())return b.preventDefault(),void d.go(h[i].redirectState)}})}]),window.globals={environment:document.URL.indexOf("http://localhost")>-1?"development":"production"},window.views={get:function(a){return a.indexOf(".html")<0&&(a+=".html"),"/views/"+a}},angular.module("bmsApp").run(["$rootScope",function(a){a.views=window.views}]).constant("environment",window.globals.environment),angular.module("bmsApp").config(["$urlRouterProvider","$stateProvider","$httpProvider","$locationProvider","$modalProvider",function(a,b,c,d,e){angular.extend(e.defaults,{placement:"center",sort:!1}),a.otherwise("/dashboard"),b.state("main",{templateUrl:window.views.get("main.html"),controller:"MainCtrl","abstract":!0}).state("main.dashboard",{url:"/dashboard",templateUrl:window.views.get("pages/dashboard.html"),controller:"DashboardCtrl"}).state("main.projects",{url:"/projects",templateUrl:window.views.get("projects/main.html"),controller:"ProjectsMainCtrl"}).state("main.projects.all",{url:"/",templateUrl:window.views.get("projects/all.html"),controller:"ProjectsAllCtrl"}).state("main.projects.create",{url:"/create",templateUrl:window.views.get("projects/create.html"),controller:"ProjectsCreateCtrl"}).state("main.projects.edit",{url:"/edit/:id",templateUrl:window.views.get("projects/edit.html"),controller:"ProjectsEditCtrl"}).state("main.projects.show",{url:"/show/:id",templateUrl:window.views.get("projects/show.html"),controller:"ProjectsShowCtrl"}).state("main.profile",{url:"/profile",templateUrl:window.views.get("pages/profile.html"),controller:"ProfileCtrl"}).state("loading",{url:"/loading",templateUrl:window.views.get("pages/loading.html"),controller:"LoadingCtrl"}).state("complete-profile",{url:"/complete-profile",templateUrl:window.views.get("pages/complete-profile.html"),controller:"CompleteProfileCtrl"}).state("login",{url:"/login",templateUrl:window.views.get("pages/login.html"),controller:"LoginCtrl"}).state("register",{url:"/register",templateUrl:window.views.get("pages/register.html"),controller:"RegisterCtrl"}).state("logout",{url:"/logout",controller:"LogoutCtrl"})}]),angular.module("bmsApp").run(["StateFilter","Auth",function(a,b){a.register("auth",["complete-profile","main.**"],function(){return b.isLoggedIn()},"login"),a.register("guest",["login","register"],function(){return!b.isLoggedIn()},"main.dashboard"),a.register("complete-profile",["main.**"],function(){return b.hasCompletedProfile()},"complete-profile"),a.register("not-complete-profile",["complete-profile"],function(){return!b.hasCompletedProfile()},"main.dashboard")}]),angular.module("bmsApp").controller("MainCtrl",["$scope","Notification","$interval","User","Auth",function(a,b,c,d,e){a.authUser=e.get(),a.page={title:""},a.dropdown={notifications:[{text:"Show All notifications",href:"#/notifications"}],users:[{text:"Show All users",href:"#/users"}]};var f=function(b){for(var c=b.length-1;c>=0;c--)a.dropdown.notifications.unshift({text:b[c].body,href:b[c].url})},g=function(b){for(var c=b.length-1;c>=0;c--)a.dropdown.users.unshift({text:"New user: "+b[c].email})},h=function(){b.getNew(f).then(d.getNew).then(g).then(d.checkUserIn)};c(h,2e4),h(),a.toggleSideMenu=function(){$(".inner-container").toggleClass("side-closed")},a.toggleSubmenu=function(a){$(a.currentTarget).toggleClass("menu-opened")},a.hasPermission=function(a,b){return e.hasPermission(a,b)}}]),angular.module("bmsApp").controller("LoginCtrl",["$scope","Auth","$state",function(a,b,c){var d=function(){c.go("main.dashboard")},e=function(b){a.errors=b.plainMessage()};a.loginUser=function(a){b.login(a).then(d).catch(e)}}]),angular.module("bmsApp").controller("DashboardCtrl",["$scope","$upload","User","Project",function(a,b,c,d){a.page.title="Dashboard",d.getMe().then(function(b){a.myProjects=b})}]),angular.module("bmsApp").controller("ProjectsCreateCtrl",["$scope","Project","$state",function(a,b,c){a.page.title="Create project",a.project={name:"",company:"",serial_number:"",start_date:"",end_date:""};var d=function(a){c.go("main.projects.edit",a)};a.submit=function(a){b.create(a).then(d)}}]),angular.module("bmsApp").controller("ProjectsMainCtrl",["$scope","FileManager",function(a,b){a.attachFiles=function(a){var c={multipleFiles:!0};b.open(c).then(function(b){void 0===a.files&&(a.files=[]),a.files=a.files.concat(b)})},a.getFilename=function(a){return a.url.substring(a.url.lastIndexOf("/")+1)},a.getFileIcon=function(a){switch(a.type){case"image":return"fa fa-photo";case"pdf":return"fa fa-file-pdf-o";case"image":return"fa fa-file-word-o"}}}]),angular.module("bmsApp").factory("WebService",["$http","ResponseError","$q",function(a,b,c){var d=function(d,e,f){return a({method:d,url:e,data:f}).then(function(a){return a.data}).catch(function(a){return c.reject(b.instance(a.data,a.status))})};return{get:function(a,b){return d("GET",a,b)},post:function(a,b){return d("POST",a,b)},put:function(a,b){return d("PUT",a,b)},"delete":function(a,b){return d("DELETE",a,b)}}}]),angular.module("bmsApp").factory("User",["WebService",function(a){return{getMe:function(){return a.get("/api/users/me")},getAll:function(){return a.get("/api/users")},getNew:function(){return a.get("/api/users/new")},sendEmailValidation:function(b){return a.put("/api/users/send-email",{email:b})},checkUserIn:function(){return a.put("/api/users/check-in")},setDepartments:function(b){return a.put("/api/users/set-departments",{departments:b})},updateProfileImage:function(b){return a.put("/api/users/profile-image",{image:b})},register:function(b){return a.post("/api/users/register",b)},login:function(b){return a.post("/api/users/login",b)},accept:function(b){return a.put("/api/users/accept/"+b.id)},refuse:function(b){return a.put("/api/users/refuse/"+b.id)},logout:function(){return a.put("/api/users/logout")},destroy:function(b){return a.delete("/api/users/"+b.id)}}}]),angular.module("bmsApp").factory("Permission",["WebService",function(a){return{getByDepartment:function(b){return a.get("/api/permissions/"+b.id)},updateDepartment:function(b){return a.get("/api/permissions/"+b.id)},getMe:function(){return a.get("/api/permissions/me")}}}]),angular.module("bmsApp").factory("Project",["WebService",function(a){return{getAll:function(){return a.get("/api/projects")},getMe:function(){return a.get("/api/projects/me")},show:function(b){return a.get("/api/projects/"+b)},create:function(b){return a.post("/api/projects",b)},update:function(b){return a.put("/api/projects/"+b.id,b)},accept:function(b){return a.put("/api/projects/accept/"+b.id)},destroy:function(b){return a.delete("/api/projects/"+b.id)},addUser:function(b,c){return a.put("/api/projects/add-user/"+b.id+"/"+c.id)},removeUser:function(){return a.put("/api/projects/remove-user/"+project.id+"/"+user.id)},setUsers:function(){return a.put("/api/projects/set-users/"+project.id+"/"+user.id)}}}]),angular.module("bmsApp").factory("ProjectComment",["WebService",function(a){return{getByProject:function(b){return a.get("/api/comments/project/"+b.id)},create:function(b,c){return a.post("/api/comments/project/"+b.id,c)},update:function(b){return a.post("/api/comments/"+b.id,b)},destroy:function(b){return a.delete("/api/comments/"+b.id)}}}]),angular.module("bmsApp").factory("ProjectStage",["WebService",function(a){return{getByProject:function(b){return a.get("/api/stages/"+b.id)},create:function(b,c){return a.post("/api/stages/"+b.id,c)},setProjectStages:function(b,c){return a.post("/api/stages/set/"+b.id,c)},update:function(b){return a.put("/api/stages/"+b.id,b)},destroy:function(b){return a.put("/api/stages/"+b.id)}}}]),angular.module("bmsApp").factory("Drive",["WebService",function(a){return{getMe:function(){return a.get("/api/drives/me")},getMain:function(){return a.get("/api/drives/main")},create:function(b){return a.post("/api/drives",b)},"delete":function(b){return a.delete("/api/drives/"+b.id)}}}]),angular.module("bmsApp").factory("File",["WebService","$upload","$q",function(a,b,c){var d=function(a,d){var e=c.defer();return b.upload({url:a,method:"POST",file:d}).progress(function(a){e.notify(parseInt(100*a.loaded/a.total))}).success(function(a){e.resolve(a)}),e.promise};return{getByDrive:function(b){return a.get("/api/files/"+b.id)},uploadToDrive:function(a,b){return d("/api/files/upload/"+a.id,b)},uploadToMainDrive:function(a){return d("/api/files/upload-to-main",a)},getDriveImages:function(b){return a.get("/api/files/images/"+b.id)},getDriveDocuments:function(b){return a.get("/api/files/documents/"+b.id)},destroy:function(b,c){return a.get("/api/files/"+b.id+"/"+c.id)}}}]),angular.module("bmsApp").factory("Notification",["WebService",function(a){return{getNew:function(){return a.get("/api/notifications/new")},notifyAll:function(){return a.put("/api/notifications/notify-all")},notifyProjectUsers:function(b){return a.put("/api/notifications/notify-project-users/"+b.id)}}}]),angular.module("bmsApp").factory("ResponseError",function(){var a=function(a,b){this.messages=function(){return a},this.plainMessage=function(b){b=void 0===b?"<br/>":b;var c="";for(var d in a)c+=a[d]instanceof Array?a[d].join(b)+b:a[d]+b;return c},this.isValidation=function(){return"validation"==this.getType()},this.isUnauthorized=function(){return"unauthorized"==this.getType()},this.isForbidden=function(){return"forbidden"==this.getType()},this.isNotFound=function(){return"notfound"==this.getType()},this.isInternalServer=function(){return"internal_server"==this.getType()},this.isNotKnown=function(){return"unknown"==this.getType()},this.getType=function(){switch(b){case 400:return"validation";case 401:return"unauthorized";case 403:return"forbidden";case 404:return"notfound";case 500:return"internal_server";default:return"unknown"}}};return{instance:function(b,c){return new a(b,c)}}}),angular.module("bmsApp").controller("RegisterCtrl",["$scope","Auth","User","Department","$state","Modal",function(a,b,c,d,e,f){d.getAll().then(function(b){a.departments=b}),a.submit={title:"Register",disabled:!1};var g=function(b){a.errors=b.plainMessage(),a.submit.title="Register",a.submit.disabled=!1},h=function(a){return a},i=function(a){return c.sendEmailValidation(a.email)},j=function(){var a={description:"An email has send with information to validate your account.",status:"success"};f.open("message",{message:a})},k=function(){e.go("login")};a.registerUser=function(c){a.submit.title="Registering...",a.submit.disabled=!0,b.register(c).then(h).then(i).then(j).then(k).catch(g)}}]),angular.module("bmsApp").controller("ProfileCtrl",["$scope","User",function(a){a.page.title="Profile page"}]),angular.module("bmsApp").factory("Auth",["User",function(a){var b=null;return{request:function(){return a.getMe().then(function(a){return b=a,a})},register:function(b){return a.register(b)},login:function(c){return a.login(c).then(function(a){return b=a,a})},logout:function(){return a.logout().then(function(){b=null})},isLoggedIn:function(){return null!=b},hasPermission:function(a,c){for(var d=b.permissions.length-1;d>=0;d--){var e=b.permissions[d].name.split("."),f=e[0]==a&&(void 0===c||e[1]==c||"*"==e[1]);if(f)return!0}return!1},get:function(){return b},hasCompletedProfile:function(){return this.isLoggedIn()&&this.get().profile_image&&this.get().departments.length>0}}}]),angular.module("bmsApp").controller("LoadingCtrl",function(){}),angular.module("bmsApp").factory("PathHistory",["$location",function(a){var b=[],c="/",d=function(){return b.length>1?b.splice(-2)[0]:c};return{setDefault:function(a){c=a},add:function(a){b.push(a)},previous:function(){var b=d();a.path(b)}}}]),angular.module("bmsApp").factory("Department",["WebService",function(a){return{getAll:function(){return a.get("/api/departments")}}}]),angular.module("bmsApp").controller("CompleteProfileCtrl",["$scope","Department","Auth","$state","User","$q","FileManager",function(a,b,c,d,e,f,g){b.getAll().then(function(b){a.departments=b}),a.submit={title:"Submit",disabled:!1};var h=function(b){a.errors=b.plainMessage()},i=function(){d.go("main.dashboard")},j=function(a,b){var c=e.setDepartments(a),d=e.updateProfileImage(b);return f.all([c,d])},k=function(){return c.request()};a.completeProfile=function(b,c){return b&&0!=b.length?c&&""!=c?(a.submit.title="Saving...",a.submit.disabled=!0,void j(b,c).then(k).then(i).catch(h)):void(a.errors="You have to upload image"):void(a.errors="You have to choose departments")},a.setProfileImage=function(){var b={fileTypes:["image"]};g.open(b).then(function(b){a.image=b[0].url})}}]),angular.module("bmsApp").factory("StateFilter",["$state","Helpers",function(a,b){var c=[],d=function(a,c){return b.type.glob(a)?b.glob.match(a,c.name):a===c.name},e=function(a){for(var b=[],e=0;e<c.length;e++)for(var f=c[e].states.length-1;f>=0;f--)d(c[e].states[f],a)&&b.push(c[e]);return b};return{all:function(){return c},register:function(a,b,d,e){c.push({name:a,states:b,passes:d,redirectState:e})},get:function(a){return e(a)}}}]),angular.module("bmsApp").factory("Helpers",function(){return{type:{promise:function(a){return angular.isObject(a)&&angular.isObject(a.promise)&&a.promise.then instanceof Function&&a.promise["catch"]instanceof Function&&a.promise["finally"]instanceof Function},array:function(a){return a instanceof Array},glob:function(a){return a.indexOf("*")>-1}},string:{getLocation:function(a){var b=document.createElement("a");return b.href=a,b},rtrim:function(a,b){b=b||"\\s",a.replace(new RegExp("["+b+"]+$","g"),"")},ltrim:function(a,b){b=b||"\\s",a.replace(new RegExp("^["+b+"]+","g"),"")},trim:function(a,b){return this.ltrim(this.rtrim(a,b),b)},ucfirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},slugify:function(a){return a&&a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}},glob:{match:function(a,b){var c=a.split("."),d=b.split(".");if("**"===c[0]&&(d=d.slice(d.indexOf(c[1])),d.unshift("**")),"**"===c[c.length-1]&&(d.splice(d.indexOf(c[c.length-2])+1,Number.MAX_VALUE),d.push("**")),c.length!=d.length)return!1;for(var e=0,f=c.length;f>e;e++)"*"===c[e]&&(d[e]="*");return d.join("")===c.join("")}}}}),angular.module("bmsApp").directive("fallbackSrc",function(){return{restrict:"A",scope:{ngSrc:"@"},link:function(a,b,c){a.$watch("ngSrc",function(a){""===a&&angular.element(b).attr("src",c.fallbackSrc)}),b.bind("error",function(){angular.element(this).attr("src",c.fallbackSrc)})}}}),angular.module("bmsApp").factory("FileManager",["Modal","$q",function(a,b){var c=null,d=[],e={multipleFiles:!1,uploadMethods:["computer","drag-and-drop"],fileTypes:["image","doc","pdf"]},f=function(a){for(var b=d.length-1;b>=0;b--)if(angular.equals(d[b],a))return b;return-1},g={deferred:null,open:function(c){return this.setConfiguration(c),a.open("drive"),a.listen("drive","hide.before").then(g.deselectAll),this.deferred=b.defer(),this.deferred.promise},close:function(){a.close()},finish:function(){this.deferred.resolve(angular.copy(d)),this.close()},setConfiguration:function(a){c=angular.extend(e,a)},getConfigurations:function(){return c},selectFile:function(a){d.push(a)},deselectFile:function(a){var b=f(a);b>-1&&d.splice(b,1)},isFileSelected:function(a){return f(a)>-1},countSelectedFiles:function(){return d.length},deselectAll:function(){d=[]},isMultipleFilesEnabled:function(){return c.multipleFiles},getUploadMethods:function(){return c.uploadMethods},getFileTypes:function(){return c.fileTypes},onlyImages:function(){return 1==c.fileTypes.length&&"image"==c.fileTypes[0]}};return g}]),angular.module("bmsApp").factory("Modal",["$modal","$rootScope","$q",function(a,b,c){var d=null,e=function(a){return window.views.get("modals/"+a+".html")},f=function(a){return a+"Modal"};return{open:function(g,h,i){this.close();var j=c.defer(),k={template:e(g),scope:b.$new(!0),prefixEvent:f(g)};return k.scope.data=h,k.scope.deferred=j,k=angular.extend(k,i),d=a(k),j.promise},close:function(){null!=d&&"function"==typeof d.hide&&d.hide()},listen:function(a,d){var e=c.defer(),g=f(a)+"."+d;return b.$on(g,function(a){e.resolve(a)}),e.promise}}}]),angular.module("bmsApp").directive("imagedrop",["$parse","ImageDrop",function(a,b){return{restrict:"EA",link:function(){var a=function(a){a.preventDefault(),$("body").addClass("dragOver"),$("body").removeClass("dragEnd")},c=function(a){a.preventDefault(),$("body").addClass("dragEnd"),$("body").removeClass("dragOver")},d=function(a){b.callListener(a)};$(document).bind("dragover",a),$(document).bind("dragleave",c).bind("drop",function(a){c(a),d(a.originalEvent.dataTransfer.files[0])})}}}]),angular.module("bmsApp").factory("ImageDrop",["$rootScope",function(a){var b=[];a.$on("$stateChangeStart",function(){b=[]});var c={addListener:function(a){b.push(a)},getListener:function(){return b[b.length-1]},popListener:function(){b.pop()},callListener:function(a){b.length>0&&this.getListener()(a)}};return c}]),angular.module("bmsApp").controller("DriveCtrl",["$scope","Drive","FileManager","Auth",function(a,b,c){a.isMultipleSelectEnabled=function(){return c.isMultipleFilesEnabled()},a.toggleSelection=function(b){c.isFileSelected(b)?c.deselectFile(b):c.selectFile(b),c.isMultipleFilesEnabled()||a.finishSelection()},a.selectAndFinish=function(b){c.isFileSelected(b)||c.selectFile(b),a.finishSelection()},a.countSelectedFiles=function(){return c.countSelectedFiles()},a.finishSelection=function(){c.finish()},a.deselectAll=function(){c.deselectAll()},a.isFileSelected=function(a){return c.isFileSelected(a)},a.tabs=[{title:"Upload",template:window.views.get("modals/drive/drive.upload.html")},{title:"Drive",template:window.views.get("modals/drive/drive.files.html")}],a.tabs.activeTab=0,a.changeMainTab=function(b){for(var c=0;c<a.tabs.length;c++)if(a.tabs[c].title.toUpperCase()==b.toUpperCase())return void(a.tabs.activeTab=c)},a.getMainTabTitle=function(b){return a.tabs[b].title},a.isActiveMainTab=function(b){return a.getMainTabTitle(a.tabs.activeTab).toLowerCase()==b.toLowerCase()},b.getMain().then(function(b){a.drive=b,void 0===a.drive.files&&(a.drive.files=[])}),a.cancel=function(){a.$hide()}}]),angular.module("bmsApp").controller("DriveFilesCtrl",["$scope","FileManager",function(a,b){a.query=b.onlyImages()?{type:"image"}:{}}]),angular.module("bmsApp").controller("DriveUploadCtrl",["$scope","ImageDrop","File","FileManager",function(a,b,c,d){var e={view:"",showUploadingView:function(){this.view="uploading"},showUploaderView:function(){this.view="uploader"},showSuccessStatus:function(){this.view="success-status"},showErrorStatus:function(){this.view="error-status"},isSuccessStatus:function(){return"success-status"==this.view},isErrorStatus:function(){return"error-status"==this.view},isUploaderView:function(){return"uploader"==this.view},isUploadingView:function(){return"uploading"==this.view}};a.Tab=e;var f={progress:0,uploading:!1,onErrorListeners:[],onUploadListeners:[],methods:[],drive:null,multipleFiles:!1,init:function(a,b,c){f.methods=a,f.drive=b,f.multipleFiles=c},reset:function(){f.progress=0,f.uploading=!1},inProgress:function(a){f.progress=a},uploadSucceed:function(a){f.callOnUploadListeners(a),f.reset()},uploadFailed:function(a){f.callOnErrorListeners(a),f.reset()},uploadFiles:function(a){e.showUploadingView(),f.uploading=!0,c.uploadToDrive(f.drive,a[0]).then(f.uploadSucceed,f.uploadFailed,f.inProgress)},isUploading:function(){return f.uploading},onUpload:function(a){f.onUploadListeners.push(a)},onError:function(a){f.onErrorListeners.push(a)},callOnUploadListeners:function(a){for(var b=f.onUploadListeners.length-1;b>=0;b--)f.onUploadListeners[b](a)},callOnErrorListeners:function(a){for(var b=f.onErrorListeners.length-1;b>=0;b--)f.onErrorListeners[b](a)},getMethods:function(){return f.methods},hasMethod:function(a){return f.getMethods().indexOf(a)>-1},getProgress:function(){return f.progress},getProgressStyle:function(){return{width:f.progress+"%"}},hasComputerMethod:function(){return f.hasMethod("computer")},hasDropMethod:function(){return f.hasMethod("drag-and-drop")},isMultipleFiles:function(){return this.multipleFiles}};a.Uploader=f;var g=function(){var b=!1;a.openFileDialog=function(){$("#hiddenFileUploader").trigger("click"),b||$("#hiddenFileUploader").on("change",function(){f.uploadFiles(this.files),a.$apply(),b=!0,$(this).val("")})}},h=function(){b.addListener(function(b){f.uploadFiles([b]),a.$apply()})},i=function(){f.onUpload(function(b){e.showSuccessStatus("Image uploaded successfully"),a.drive.files.push(b),a.lastUploadedFile=b}),f.onError(function(a){e.showErrorStatus(a)})},j=function(b){a.drive=b,f.init(d.getUploadMethods(),b,d.isMultipleFilesEnabled()),f.hasComputerMethod()&&g(),f.hasDropMethod()&&h(),i(),e.showUploaderView()};a.$watch("drive",function(a){a&&j(a)}),e.showUploaderView()}]),angular.module("bmsApp").controller("ProjectsEditCtrl",["$scope","$stateParams","Project","StatusModal","FileManager","ProjectStage","$state","Modal","$alert","User",function(a,b,c,d,e,f,g,h,i,j){a.project={};var k=function(b){a.project=b,a.page.title="Edit project "+b.name};j.getAll().then(function(b){a.users=b}),c.show(b.id).then(k);a.addStage=function(a){void 0===a.stages&&(a.stages=[]),a.stages.push({notes:"",end_date:""})},a.removeStage=function(a,b){a.stages.splice(b,1)},a.removeFile=function(a,b){a.files.splice(b,1)};var l=function(a,b){void 0===a.users&&(a.users=[]);for(var c=a.users.length-1;c>=0;c--)if(a.users[c].id==b.id)return c;return-1};a.toggleUser=function(a,b){this.isUserSelected(a,b)?a.users.splice(l(a,b),1):a.users.push(b)},a.isUserSelected=function(a,b){return l(a,b)>-1};var m=function(){i({title:"Success",content:"Project has been saved successfully",placement:"top-right",type:"success",show:!0})},n=function(){i({title:"Error",content:"Something went wrong",placement:"top-right",type:"danger",show:!0})};a.submit=function(a){c.update(a).then(m).catch(n)}}]),angular.module("bmsApp").controller("ProjectsShowCtrl",["$scope","Project","$stateParams","ProjectComment",function(a,b,c,d){b.show(c.id).then(function(b){a.page.title="Project "+b.name,a.project=b});var e=function(){a.comment={body:"",files:[]}};e(),a.addComment=function(b,c){d.create(b,c).then(function(b){a.project.comments.push(b),e()})}}]),angular.module("bmsApp").controller("PermissionsMainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("bmsApp").controller("PermissionsEditCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("bmsApp").controller("ModalMessageCtrl",["$scope",function(a){a.message=a.data.message,a.isSuccessStatus=function(){return"success"==a.message.status},a.isErrorStatus=function(){return"error"==a.message.status}}]),angular.module("bmsApp").controller("LogoutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("bmsApp").factory("StatusModal",["Modal","$q",function(a,b){var c;return{init:function(){c=[]},add:function(a,d){var e={promise:a,description:d,resolved:!1};a instanceof Array?b.all(a).then(function(){e.resolved=!0}):a.then(function(){e.resolved=!0}),c.push(e)},afterAll:function(){for(var a=[],d=c.length-1;d>=0;d--)a.push(c[d].promise);return b.all(a)},open:function(){return a.open("status",{allStatus:c})}}}]),angular.module("bmsApp").controller("ModalStatusCtrl",["$scope","StatusModal","$interval",function(a,b,c){a.allStatus=a.data.allStatus,a.getStatusIcon=function(a){return a.resolved?"fa fa-check-circle":"fa fa-spinner fa-spin"};var d=function(){c(function(){a.deferred.resolve(),a.$hide()},2e3)};b.afterAll().then(d)}]),angular.module("bmsApp").controller("ProjectsAllCtrl",["$scope","Project",function(a,b){b.getAll().then(function(b){a.projects=b})}]);